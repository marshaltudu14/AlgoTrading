Status: Draft

Story:
  **As a** developer,
  **I want** the `MoEAgent` to effectively orchestrate specialized agents and the `GatingNetwork` to dynamically select experts,
  **so that** the overall system can leverage the "wisdom of the crowd" and adapt to market regimes.

Acceptance Criteria:
1.  **2.2.1:** The `MoEAgent.select_action` method shall be changed from hard routing (`argmax`) to a weighted average of expert action probabilities.
2.  **2.2.2:** The `learn` method in `MoEAgent` shall orchestrate the learning for both the `GatingNetwork` and the individual experts.
3.  **2.2.3:** The `adapt` method in `MoEAgent` shall orchestrate the adaptation of both the `GatingNetwork` and the individual experts during the MAML inner loop.

Tasks / Subtasks:
- [ ] Modify `MoEAgent.select_action` to use weighted average of expert action probabilities (AC: 2.2.1)
- [ ] Implement `MoEAgent.learn` method to orchestrate learning for GatingNetwork and experts (AC: 2.2.2)
- [ ] Implement `MoEAgent.adapt` method to orchestrate adaptation for GatingNetwork and experts during MAML inner loop (AC: 2.2.3)

Dev Notes:
- **GatingNetwork Implementation:** Ensure the `GatingNetwork` is capable of dynamically selecting and weighting experts based on market conditions.
- **Weighted Average:** The `select_action` method should combine the outputs of specialized agents based on the weights provided by the `GatingNetwork`.
- **Orchestration:** The `learn` and `adapt` methods of `MoEAgent` will be responsible for calling the corresponding methods of the `GatingNetwork` and specialized agents.

Testing:
- Test file location: `tests/test_agents/test_moe_agent.py`
- Test standards: Follow existing project testing conventions.
- Testing frameworks and patterns to use: `pytest` for unit tests.
- Any specific testing requirements for this story:
    - Verify `MoEAgent.select_action` correctly calculates weighted average of expert probabilities.
    - Verify `MoEAgent.learn` triggers learning in both GatingNetwork and experts.
    - Verify `MoEAgent.adapt` triggers adaptation in both GatingNetwork and experts.

Change Log:
| Date       | Version | Description        | Author |
|------------|---------|--------------------|--------|
| 2025-07-20 | 1.0     | Initial story draft | Bob    |

Dev Agent Record:
  Agent Model Used:
  Debug Log References:
  Completion Notes List:
  File List:

QA Results:
