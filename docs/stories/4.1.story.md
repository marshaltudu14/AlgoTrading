---
id: story-template-v2
name: Story Document
version: 2.0
---

# Story 4.1: Task Sampling for Meta-Training

## Status
Ready for Review

## Story
**As an** RL engineer,
**I want** a mechanism to sample diverse tasks (instrument/timeframe combinations) from the `data/final` dataset,
**so that** I can effectively meta-train the RL agents for rapid adaptation.

## Acceptance Criteria
1. `src/utils/data_loader.py` (or a new utility in `src/training/`) contains a function or method to identify unique `(instrument_type, timeframe)` combinations within the `data/final` dataset.
2. This function can sample a batch of these unique combinations, representing distinct meta-training tasks.
3. The sampling mechanism ensures diversity across tasks to promote generalization.

## Tasks / Subtasks
- [x] Task 1 (AC: 1, 2, 3, 4): Implement the task sampling mechanism.
    - [x] Subtask 1.1: Enhance `DataLoader` or create a new `MetaTaskSampler` utility.
    - [x] Subtask 1.2: Implement a method to scan `data/final` and identify all unique instrument/timeframe combinations.
    - [x] Subtask 1.3: Implement a method to sample a batch of tasks.
    - [x] Subtask 1.4: Implement a method to get the data for a specific task. [Source: `docs/architecture/rl-model-architecture-detailed.md#1-srcutilsdata_loaderpy-or-new-utility---task-sampling-for-meta-training`]
- [x] Task 2: Write unit tests for the task sampling mechanism.
    - [x] Subtask 2.1: Add test cases to `tests/test_utils.py`.
    - [x] Subtask 2.2: Write a test case to verify that the correct tasks are identified.
    - [x] Subtask 2.3: Write a test case to ensure that tasks are sampled correctly and that the correct data is returned for a given task.

### Dev Agent Record
#### Agent Model Used
Gemini
#### Debug Log References
- Implemented task sampling in `src/utils/data_loader.py`.
- Added unit tests for task sampling in `tests/test_utils.py`.
#### Completion Notes List
- Enhanced `DataLoader` with `get_available_tasks`, `sample_tasks`, and `get_task_data` methods.
- Added unit tests for task sampling, covering success, empty directory, and file not found scenarios.
- Corrected `random` import in `src/utils/data_loader.py`.
- All tests passed.
#### File List
- `src/utils/data_loader.py`
- `tests/test_utils.py`
