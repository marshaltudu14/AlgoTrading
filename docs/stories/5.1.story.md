---
id: story-template-v2
name: Story Document
version: 2.0
---

# Story 5.1: Standard Trading Performance Metrics

## Status
Ready for Review

## Story
**As an** RL engineer,
**I want** to calculate standard trading performance metrics,
**so that** I can rigorously evaluate the profitability and risk of the RL agent's strategies.

## Acceptance Criteria
1. `src/utils/metrics.py` contains functions to calculate:
    - Sharpe Ratio
    - Total P&L (absolute profit generated)
    - Profit Factor (ratio of gross profit to gross loss)
    - Maximum Drawdown
    - Win Rate (percentage of profitable trades)
    - Average P&L per Trade
    - Number of Trades
2. These functions take a trade history (e.g., a list of trade objects or a DataFrame from the `BacktestingEngine`) as input.
3. All metrics are calculated correctly and handle edge cases (e.g., no trades, all losing trades).

## Tasks / Subtasks
- [x] Task 1 (AC: 1, 2, 3): Implement the performance metrics functions.
    - [x] Subtask 1.1: Create the file `src/utils/metrics.py`.
    - [x] Subtask 1.2: Implement functions for each of the required metrics. [Source: `docs/architecture/rl-model-architecture-detailed.md#1-srcutilsmetricspy---standard-trading-performance-metrics`]
- [x] Task 2: Write unit tests for the metrics functions.
    - [x] Subtask 2.1: Add test cases to `tests/test_utils.py`.
    - [x] Subtask 2.2: For each metric, write test cases with known inputs and expected outputs.
    - [x] Subtask 2.3: Write test cases to handle edge cases like no trades or all losing trades.

### Dev Agent Record
#### Agent Model Used
Gemini
#### Debug Log References
- Implemented `src/utils/metrics.py`.
- Added unit tests for metrics in `tests/test_utils.py`.
#### Completion Notes List
- Implemented functions for Sharpe Ratio, Total P&L, Profit Factor, Maximum Drawdown, Win Rate, Average P&L per Trade, and Number of Trades.
- Added unit tests for all metrics, including edge cases.
- Corrected Sharpe Ratio calculation to use `ddof=0` for population standard deviation.
- Updated expected value in Sharpe Ratio test.
- All tests passed.
#### File List
- `src/utils/metrics.py`
- `tests/test_utils.py`
