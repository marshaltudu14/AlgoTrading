---
id: story-template-v2
name: Story Document
version: 2.0
---

# Story 1.3: Data Loader for data/raw (Backtesting Data)

## Status
Ready for Review

## Story
**As an** RL engineer,
**I want** a data loader that can efficiently load raw OHLCV data from `data/raw/`,
**so that** I can use it for backtesting the RL model.

## Acceptance Criteria
1. `src/utils/data_loader.py` contains a method `load_raw_data_for_symbol(symbol: str)`.
2. `load_raw_data_for_symbol()` successfully reads the specified CSV file (e.g., `Nifty_2.csv`) from `data/raw/` into a pandas DataFrame.
3. The loaded DataFrame contains `datetime`, `open`, `high`, `low`, `close` columns.
4. Basic data validation ensures `high >= low`, `high >= open`, `high >= close`, `low <= open`, `low <= close` for each row.
5. Error handling is implemented for missing files or invalid data, logging warnings/errors without crashing.

## Tasks / Subtasks
- [x] Task 1 (AC: 1): Implement the `load_raw_data_for_symbol` method in the `DataLoader` class.
    - [x] Subtask 1.1: Add the method `load_raw_data_for_symbol(self, symbol: str) -> pd.DataFrame` to the `DataLoader` class in `src/utils/data_loader.py`. [Source: `docs/architecture/rl-model-architecture-detailed.md#1-srcutilsdata_loaderpy---data-loading-module`]
- [x] Task 2 (AC: 2, 3): Implement the file loading logic.
    - [x] Subtask 2.1: Construct the full file path to the specified symbol's CSV file within the `data/raw/` directory.
    - [x] Subtask 2.2: Read the CSV file into a pandas DataFrame.
    - [x] Subtask 2.3: Ensure the required columns (`datetime`, `open`, `high`, `low`, `close`) are present.
- [x] Task 3 (AC: 4): Implement data validation.
    - [x] Subtask 3.1: Add a validation step to check the integrity of OHLC data (e.g., `high >= low`).
    - [x] Subtask 3.2: Log a warning and potentially drop invalid rows if data integrity issues are found.
- [x] Task 4 (AC: 5): Implement robust error handling.
    - [x] Subtask 4.1: Wrap the file reading operation in a `try-except` block to handle `FileNotFoundError`.
    - [x] Subtask 4.2: Log an error using the `logging` module if the specified file does not exist. [Source: `docs/architecture/coding-standards.md#2-python-specific-standards`]
- [x] Task 5: Write unit tests for the `load_raw_data_for_symbol` method.
    - [x] Subtask 5.1: Add new test cases to `tests/test_utils.py`.
    - [x] Subtask 5.2: Write a test case for successfully loading a valid raw data file.
    - [x] Subtask 5.3: Write a test case to ensure the method raises or handles a `FileNotFoundError` for a non-existent symbol.
    - [x] Subtask 5.4: Write a test case to verify that the OHLC data validation is working correctly.

## Dev Notes
- **File Location**: `src/utils/data_loader.py` [Source: `docs/architecture/source-tree.md#6-source-directory-src`]
- **Class**: `DataLoader`
- **Method**: `load_raw_data_for_symbol(self, symbol: str) -> pd.DataFrame`
- **Responsibilities**: This method is responsible for loading a single, specific raw data file for backtesting purposes. It must perform basic validation to ensure data quality. [Source: `docs/architecture/rl-model-architecture-detailed.md#1-srcutilsdata_loaderpy---data-loading-module`]
- **Note on Method Name**: The PRD mentions `load_data_for_symbol(symbol: str)`, but the more specific architecture document `rl-model-architecture-detailed.md` refers to `load_raw_data_for_symbol(self, symbol: str)`. This story will use the latter, more descriptive name.

### Testing
- Unit tests should be added to the existing `tests/test_utils.py` file. [Source: `docs/architecture/source-tree.md#1-top-level-directories`]
- Tests should cover successful loading, handling of missing files, and data validation logic.

## QA Results
